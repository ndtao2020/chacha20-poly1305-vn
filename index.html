<!doctype html>
<html lang="en-US">

<head>
    <meta charset="utf-8" />
    <title>chacha20_poly1305_vn example</title>
</head>

<body>
    <script type="module">
        import init, { XChaCha20Poly1305 } from "./pkg-web/chacha_poly_wasm_web.js";

        const NONCE_LENGTH = 24;
        const SECRET_LENGTH = 32;

        const Z = "ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz0123456789@#";

        const random = (characters, length) => {
            let result = "";
            const charactersLength = characters.length;
            for (let i = 0; i < length; i++) {
                result += characters.charAt(Math.floor(Math.random() * charactersLength));
            }
            return result;
        };

        const encoder = new TextEncoder();
        const decoder = new TextDecoder();

        init().then(() => {

            const secrectKey = random(Z, SECRET_LENGTH);
            const secrectBytes = encoder.encode(secrectKey)
            const nonceKey = random(Z, NONCE_LENGTH);
            const nonceBytes = encoder.encode(nonceKey);

            console.log("secrect key: ", secrectKey);
            console.log("nonce key: ", nonceKey);

            const xchacha20 = new XChaCha20Poly1305(secrectKey, nonceBytes);

            const data = random(Z, 50);

            console.log("data: ", data);

            // ========================= [Encrypt] =========================

            const encryptedBytes = xchacha20.encrypt(encoder.encode(data))
            const encryptedStr = decoder.decode(encryptedBytes)

            console.log("encrypted: ", encryptedStr);

            // ========================= [Decrypt] =========================

            const decryptedBytes = xchacha20.decrypt(encryptedBytes)
            const decryptedStr = decoder.decode(decryptedBytes)

            console.log("decrypted: ", decryptedStr);

            // ========================= [Verification] =========================
            if (data === decryptedStr) {
                console.log("Ok !");
            }
        });
    </script>
</body>

</html>